/////////////////////////////////////////////////////////////
// Cálculo de Renuncias Recaudatorias - PIB porcentual    //
// Fuente: Tabla 2015-2026 (valores manualmente ingresados) //
/////////////////////////////////////////////////////////////


* Para 2026
scalar Deducciones_2026 = 0.1068
scalar Exenciones_2026 = 0.0424
scalar Regimenes_2026 = 0.0493
scalar Diferimientos_2026 = 0.0888
scalar Facilidades_2026 = 0.0119
scalar Subsidio_2026 = 0.1184

scalar DeduccionesPF_2026 = 0.1264
scalar ExencionesPF_2026 = 0.9607
scalar RegimenesPF_2026 = 0.0128
scalar DiferimientosPF_2026 = .

scalar ExencionesIVA_2026 = 0.2515
scalar TasasRedIVA_2026 = 1.5685

scalar ExencionesIMPE_2026 = 0.0456
scalar TasasRedIMPE_2026 = 0.004

scalar EstimulFiscales_2026 = 1.006


* Para 2025
scalar Deducciones_2025 = 0.1068
scalar Exenciones_2025 = 0.0424
scalar Regimenes_2025 = 0.0493
scalar Diferimientos_2025 = 0.0888
scalar Facilidades_2025 = 0.0119
scalar Subsidio_2025 = 0.1184

scalar DeduccionesPF_2025 = 0.1264
scalar ExencionesPF_2025 = 0.9324
scalar RegimenesPF_2025 = 0.0128
scalar DiferimientosPF_2025 = .

scalar ExencionesIVA_2025 = 0.2515
scalar TasasRedIVA_2025 = 1.5685

scalar ExencionesIMPE_2025 = 0.0456
scalar TasasRedIMPE_2025 = 0.004

scalar EstimulFiscales_2025 = 1.0352



* Para 2015
scalar Deducciones_2015 = 0.076
scalar Exenciones_2015 = 0.0483
scalar Regimenes_2015 = 0.0226
scalar Diferimientos_2015 = 0.0552
scalar Facilidades_2015 = 0.0197
scalar Subsidio_2015 = 0.2355

scalar DeduccionesPF_2015 = 0.0617
scalar ExencionesPF_2015 = 0.7679
scalar RegimenesPF_2015 = 0.105
scalar DiferimientosPF_2015 = 0.0014

scalar ExencionesIVA_2015 = 0.2124
scalar TasasRedIVA_2015 = 1.0649

scalar ExencionesIMPE_2015 = 0.0383
scalar TasasRedIMPE_2015 = .

scalar EstimulFiscales_2015 = 0.2188

* Para 2016
scalar Deducciones_2016 = 0.0801
scalar Exenciones_2016 = 0.0619
scalar Regimenes_2016 = 0.0454
scalar Diferimientos_2016 = 0.0785
scalar Facilidades_2016 = 0.0209
scalar Subsidio_2016 = 0.2276

scalar DeduccionesPF_2016 = 0.0855
scalar ExencionesPF_2016 = 0.7511
scalar RegimenesPF_2016 = 0.1619
scalar DiferimientosPF_2016 = 0.0058

scalar ExencionesIVA_2016 = 0.2646
scalar TasasRedIVA_2016 = 1.1796

scalar ExencionesIMPE_2016 = 0.0431
scalar TasasRedIMPE_2016 = .

scalar EstimulFiscales_2016 = 0.4843

* Para 2017
scalar Deducciones_2017 = 0.086
scalar Exenciones_2017 = 0.0495
scalar Regimenes_2017 = 0.0516
scalar Diferimientos_2017 = 0.1291
scalar Facilidades_2017 = 0.0216
scalar Subsidio_2017 = 0.2195

scalar DeduccionesPF_2017 = 0.097
scalar ExencionesPF_2017 = 0.8014
scalar RegimenesPF_2017 = 0.1468
scalar DiferimientosPF_2017 = 0.0046

scalar ExencionesIVA_2017 = 0.2757
scalar TasasRedIVA_2017 = 1.2416

scalar ExencionesIMPE_2017 = 0.0476
scalar TasasRedIMPE_2017 = .

scalar EstimulFiscales_2017 = 0.7429

* Para 2018
scalar Deducciones_2018 = 0.0885
scalar Exenciones_2018 = 0.0513
scalar Regimenes_2018 = 0.0482
scalar Diferimientos_2018 = 0.1035
scalar Facilidades_2018 = 0.0215
scalar Subsidio_2018 = 0.2049

scalar DeduccionesPF_2018 = 0.1177
scalar ExencionesPF_2018 = 0.7176
scalar RegimenesPF_2018 = 0.1281
scalar DiferimientosPF_2018 = 0.0036

scalar ExencionesIVA_2018 = 0.2546
scalar TasasRedIVA_2018 = 1.1062

scalar ExencionesIMPE_2018 = 0.0417
scalar TasasRedIMPE_2018 = .

scalar EstimulFiscales_2018 = 0.8087

* Para 2019
scalar Deducciones_2019 = 0.099
scalar Exenciones_2019 = 0.0472
scalar Regimenes_2019 = 0.0468
scalar Diferimientos_2019 = 0.0817
scalar Facilidades_2019 = 0.0215
scalar Subsidio_2019 = 0.1984

scalar DeduccionesPF_2019 = 0.1024
scalar ExencionesPF_2019 = 0.7327
scalar RegimenesPF_2019 = 0.1164
scalar DiferimientosPF_2019 = 0.0006

scalar ExencionesIVA_2019 = 0.2652
scalar TasasRedIVA_2019 = 1.1666

scalar ExencionesIMPE_2019 = 0.04
scalar TasasRedIMPE_2019 = .

scalar EstimulFiscales_2019 = 0.8431

* Para 2020
scalar Deducciones_2020 = 0.1122
scalar Exenciones_2020 = 0.0489
scalar Regimenes_2020 = 0.0467
scalar Diferimientos_2020 = 0.0884
scalar Facilidades_2020 = 0.0226
scalar Subsidio_2020 = 0.2052

scalar DeduccionesPF_2020 = 0.107
scalar ExencionesPF_2020 = 0.8901
scalar RegimenesPF_2020 = 0.1094
scalar DiferimientosPF_2020 = 0.0005

scalar ExencionesIVA_2020 = 0.2352
scalar TasasRedIVA_2020 = 1.1587

scalar ExencionesIMPE_2020 = 0.0374
scalar TasasRedIMPE_2020 = .

scalar EstimulFiscales_2020 = 0.6236

* Para 2021
scalar Deducciones_2021 = 0.1184
scalar Exenciones_2021 = 0.0418
scalar Regimenes_2021 = 0.0437
scalar Diferimientos_2021 = 0.1025
scalar Facilidades_2021 = 0.0122
scalar Subsidio_2021 = 0.1581

scalar DeduccionesPF_2021 = 0.1123
scalar ExencionesPF_2021 = 0.9392
scalar RegimenesPF_2021 = 0.1004
scalar DiferimientosPF_2021 = 0.0005

scalar ExencionesIVA_2021 = 0.2425
scalar TasasRedIVA_2021 = 1.2187

scalar ExencionesIMPE_2021 = 0.0284
scalar TasasRedIMPE_2021 = .

scalar EstimulFiscales_2021 = 0.9593

* Para 2022
scalar Deducciones_2022 = 0.1144
scalar Exenciones_2022 = 0.0293
scalar Regimenes_2022 = 0.0451
scalar Diferimientos_2022 = 0.1014
scalar Facilidades_2022 = 0.0125
scalar Subsidio_2022 = 0.1492

scalar DeduccionesPF_2022 = 0.1178
scalar ExencionesPF_2022 = 0.7125
scalar RegimenesPF_2022 = 0.0216
scalar DiferimientosPF_2022 = 0.0

scalar ExencionesIVA_2022 = 0.2318
scalar TasasRedIVA_2022 = 1.6339

scalar ExencionesIMPE_2022 = 0.0262
scalar TasasRedIMPE_2022 = .

scalar EstimulFiscales_2022 = 1.6469

* Para 2024
scalar Deducciones_2024 = 0.0991
scalar Exenciones_2024 = 0.034
scalar Regimenes_2024 = 0.0468
scalar Diferimientos_2024 = 0.1094
scalar Facilidades_2024 = 0.0119
scalar Subsidio_2024 = 0.0968

scalar DeduccionesPF_2024 = 0.1333
scalar ExencionesPF_2024 = 0.783
scalar RegimenesPF_2024 = 0.0127
scalar DiferimientosPF_2024 = .

scalar ExencionesIVA_2024 = 0.2519
scalar TasasRedIVA_2024 = 1.5701

scalar ExencionesIMPE_2024 = 0.0368
scalar TasasRedIMPE_2024 = .

scalar EstimulFiscales_2024 = 0.9981

* Para 2025
scalar Deducciones_2025 = 0.1068
scalar Exenciones_2025 = 0.0424
scalar Regimenes_2025 = 0.0493

******************************************************
* Sección 2: Sumas por componente por año
******************************************************

foreach year of local years {
	scalar ISREmpresas_`year' = ///
		Deducciones_`year' + Exenciones_`year' + Regimenes_`year' + Diferimientos_`year' + Facilidades_`year' + Subsidio_`year'
	
	scalar ISRPersonas_`year' = ///
		DeduccionesPF_`year' + ExencionesPF_`year' + RegimenesPF_`year' + DiferimientosPF_`year'

	scalar IVA_`year' = ExencionesIVA_`year' + TasasRedIVA_`year'
	scalar IMPE_`year' = ExencionesIMPE_`year' + TasasRedIMPE_`year'
	
	scalar TotalRenuncias_`year' = ISREmpresas_`year' + ISRPersonas_`year' + IVA_`year' + IMPE_`year' + EstimulFiscales_`year'
}

******************************************************
* Sección 3: Promedios por componente (históricos)
******************************************************

* ISR Empresas
scalar PromISREmpresas = 0
scalar PromISRPersonas = 0
scalar PromIVA = 0
scalar PromIMPE = 0
scalar PromESTIMULOS = 0

local n = 0
foreach year of local years {
	if !missing(ISREmpresas_`year') {
		scalar PromISREmpresas = PromISREmpresas + ISREmpresas_`year'
		scalar PromISRPersonas = PromISRPersonas + ISRPersonas_`year'
		scalar PromIVA = PromIVA + IVA_`year'
		scalar PromIMPE = PromIMPE + IMPE_`year'
		scalar PromESTIMULOS = PromESTIMULOS + EstimulFiscales_`year'
		local ++n
	}
}

scalar PromISREmpresas = PromISREmpresas / `n'
scalar PromISRPersonas = PromISRPersonas / `n'
scalar PromIVA = PromIVA / `n'
scalar PromIMPE = PromIMPE / `n'
scalar PromESTIMULOS = PromESTIMULOS / `n'

scalar PromTotal = PromISREmpresas + PromISRPersonas + PromIVA + PromIMPE + PromESTIMULOS

******************************************************
* Sección 4: Formato LaTeX (strings)
******************************************************

foreach s of global scalars {
	capture confirm scalar `s'
	if !_rc {
		if strpos("`s'", "PIB") {
			scalar `s'str = string(`s', "%7.3fc")
		}
		else {
			scalar `s'str = string(`s', "%20.2fc")
		}
	}
}

******************************************************
* Sección 5: Diccionario para LaTeX (\nombreing)
******************************************************

* Diccionario de salida
display "----------- Diccionario LaTeX -----------"
foreach s of global scalars {
	capture confirm scalar `s'str
	if !_rc {
		local name = subinstr("`s'str", "_", "", .)
		local macro = "\\`name'ing"
		display "`macro'"
	}
}



/////////////////////////////////////////////////////
// EXPORTAR A LaTeX
/////////////////////////////////////////////////////
scalarlatex, log(ingresos) alt(ing)




/////////////////////////////////////////////////////
// Gráfica de Histórico de Renuncias Recaudatorias
/////////////////////////////////////////////////////

clear
input str4 anio double(isre isrf iva ie est_fis)
"2015" 0.4573 1.0360 1.2773 0.0383 0.2188
"2016" 0.5144 1.0032 1.4442 0.0431 0.4843
"2017" 0.5563 1.0500 1.5173 0.0476 0.7429
"2018" 0.5179 0.9669 1.3608 0.0417 0.8087
"2019" 0.4946 0.9511 1.4318 0.0400 0.8431
"2020" 0.5239 1.1070 1.3939 0.0374 0.6236
"2021" 0.4767 1.1524 1.4612 0.0284 0.9593
"2022" 0.4519 0.8519 1.8657 0.0262 1.6469
"2024" 0.4099 0.9290 1.8220 0.0368 0.9981
"2025" 0.4176 1.0716 1.8200 0.0496 1.0352
"2026" 0.4176 1.0999 1.8200 0.0496 1.0060
end


//	Por indicación de Rick, aqui se debe de poner % del PIB en el eje de las "X"

graph hbar (sum) isre isrf iva ie est_fis, over(anio) stack asyvars ///
title("Renuncias recaudatorias (Gasto fiscal o tributario)") ///
blabel(bar, position(center) format(%16.2fc) size(small) color(white)) ///
legend(label(1 "ISRE") label(2 "ISRF") ///
       label(3 "IVA") label(4 "Impuestos Especiales (IEPS e ISAN)") ///
       label(5 "Estímulos Fiscales")) ///
caption("Fuente: Elaborado por el CIEP, con información de SHCP.") ///
note("Nota: Unidades: % del PIB", size(small))